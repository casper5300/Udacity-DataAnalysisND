---
title: "Rossmann Store Sale"
output: html_document
---
```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
```


## load library
```{r}
library(scales)
library(ggplot2)
library(gridExtra)
library(lubridate)
library(dplyr)
library(forecast)

```

## load data
```{r}
train <- read.csv('train.csv')
store_add <- read.csv('store.csv')
test_df <- read.csv('test.csv')
```

## 这里kaggle的一个竞赛项目，预测未来日期的销售额。除训练集外，还有一个补充的数据。
先粗略的看一下数据集。
```{r}
head(train,n=10L)
```
```{r}
tail(train,n=10L)
```

大概可以看出，这个数据集是按日期时间倒序排列的。Sales和Customers这两个变量是我们要预测的目标。

```{r}
head(store_add,n=10L)
```

这个Dataframe是各商店的补充信息，包括了竞争对手的情报和promotion的信息。


## 分析训练集
先通过summary对训练集有一个大概的了解。

```{r}
names(train)
summary(train)
```

这里有9个变量除去预测变量，有7个变量是模型训练可能用到的特征。Store是分店的ID，我们要预测的就是这1115个分店的未来销售情况。Date这个变量每个都有1115条记录，对应1115个分店。


```{r}
str(train)
```

### 根据kaggle项目对变量的定义，对以下几个变量进行类型转换。

```{r}
train$SchoolHoliday <- factor(train$SchoolHoliday)
train$Open <- factor(train$Open)
train$Promo <- factor(train$Promo)
train$Date <- as.Date(train$Date)
str(train)
```


## 单变量分析

```{r}
qplot(x=Store,data=train,binwidth=1)+
  scale_x_continuous(breaks=seq(1,1115,50))+
  scale_y_continuous(breaks=seq(0,1200,100))

```


这里可以看出 有些门店的记录要少于其它门店，并且少的数量也似乎一样。

```{r}
by_date <-  train%>%
  group_by(Date)%>%
  summarise(numberofstore=n())%>%
  arrange(Date)
ggplot(aes(Date,numberofstore),data=by_date)+
  geom_line(size=1,color='blue')+
  scale_x_date(date_breaks='4 month')

```


我们发现总共有180个分店缺少一部分从2014/7到2015/1的销售记录。考虑到这个任务的目标和训练集都是日期序列的，这部分缺失值可能会让模型无法捕捉到这些门店在这些月间一些周期性或季节性的特征。

```{r}
bystore <- train%>%
  group_by(Store)%>%
  summarise(num=n())%>%
  arrange(Store)

missstore <- bystore[bystore$num<900,]
missstore
```

### 对数据集操作：增加一个临时变量指出门店是否有缺失数据以便分析。

```{r}
train$HaveMissDate <- ifelse(train$Store %in% unique(missstore$Store),1,0)
train$HaveMissDate <- factor(train$HaveMissDate)
table(train$HaveMissDate)
```



接下来看DayOfWeek

```{r}
qplot(x=factor(DayOfWeek),data=train)
```

通过柱状图我们看出这个变量呈均匀分布。

现在看看StateHoliday变量，这关系到分店是否开门营业。

```{r}
qplot(x=StateHoliday,data=train)
```


通常来讲，大部分门店会在节假日关门，这里0 表示不是节目。可以看出，stateholiday占非常小的比例。


```{r}
qplot(x=SchoolHoliday,data=train)
```

这个变量表明一个分店是否受到学校假期的影响。对于0，1并没有明确的说明，那么这里猜测1是有影响0是没有。通常学校在周末也会放假。直觉上，应该这两个变量都跟Open有关系。这里可以看出受影响的比例并不高。



```{r}
qplot(x=Open,data=train)
```

Open变量0=close,1=open.这里可以看出，大部分的情况分店是开门的这也符合对前面两个变量的分析。
有一点值得注意的是，在项目说明里我们了解到有些门店因为翻修的原因而暂时关闭了。我们也许可以考虑增加一个变量来表示是否那天门店关门是因为装修。这个可以粗略的将关门日期中不是因为两种假期的情况，需要进一步分析才能确定。

```{r}
ggplot(aes(x=Customers),data=train)+
  geom_histogram(binwidth = 40,colour='white')
```

我们看到有很大一部分进店客户数量是0的情况，考虑可能跟Open变量有关。而右边大于0的销售部分近似正态分布，右端有少量异常值。


```{r}
ggplot(aes(x=Sales),data=train)+
  geom_histogram(colour='white')+
  geom_density()
  
```

这两个预测变量基本上分布有些相似，销售为0的占了很大的比例。在右端有一些异常分布。

```{r}
qplot(x=Promo,data=train)
```

Promo变量的柱状图显示没有促销活动的占更多的比例。




# 双变量分析

```{r}
qplot(x=factor(DayOfWeek),fill = Open,data=train)+
  facet_grid(~SchoolHoliday)
```


首先可以看出第7天几乎所有门店都关门了，只有少数跟学校假期没有关系的门店开门。这符合上面对0，1代表分类的猜测。

进一步观察可能跟Open有关系的变量

```{r}
p1 <-  ggplot(aes(x=factor(DayOfWeek),fill=SchoolHoliday),data=subset(train,Open==0))+
  geom_bar(colour='white')+
  ylim(0,150000)+
  scale_fill_manual(values=c("#0072B2", "#FF3366"))+
  ggtitle('Store Closed')
p2 <- ggplot(aes(x=factor(DayOfWeek),fill=StateHoliday),data=subset(train,Open==0))+
  geom_bar()+
  ylim(0,150000)+
  scale_fill_manual(values=c("#0099CC", "#FF3366","#993333","#FF0000"))+
  ggtitle('Store Closed')
p3 <- ggplot(aes(x=factor(DayOfWeek),fill=Open),data=train)+
  geom_bar()
  
grid.arrange(p1,p2,p3,ncol=1)
```


通过对比，可以看出1到5这几天中关门的情况跟StateHoliday基本上一致。

接着看下在1到6这几天里不是任何节假日的情况下有哪些门店关门了，时间是多久。

```{r}
subsets <- subset(train,Open == 0 & StateHoliday == 0 & SchoolHoliday ==0 & DayOfWeek != 7)
length(unique(subsets$Store))
```

通过unique函数，可以看出有143家分店在这三年间可能因店面翻新而关店一段时间。

```{r}
summary(subsets)
```


```{r}
p1 <- qplot(x=Date,y=Store,data=subset(subsets,year(Date)==2013))+ggtitle('2013')
p2 <- qplot(x=Date,y=Store,data=subset(subsets,year(Date)==2014))+ggtitle('2014')
p3 <-  qplot(x=Date,y=Store,data=subset(subsets,year(Date)==2015))+ggtitle('2015')
grid.arrange(p1,p2,p3,ncol=3)
```


观察可知有少量门店每隔一小段时间或者一段时间有关门的情况，这部分应该符合关门翻修关店的情况。但是其中有三个时间点大部分门店有短时间的关店，这可能不太符合翻修情况。需要对这些月份的数据进一步观察。

```{r}

Feb <- subset(subsets,year(Date)==2015&month(Date)==2&day(Date)==16)
Feb

```


这里有32个门店2月16号临时关门而无法从已知变量中找到原因。
看下其它年份2/16号的情况

```{r}
tt <- subset(train,month(Date)==2 & day(Date)==16 )
summary(tt$StateHoliday)
summary(tt$SchoolHoliday)
```

可以看出其它年份2/16并不是一个特殊的日期。
考虑到测试集中open是确定的，这里不再做进一步的探索。
接下来看另一个变量，这里关店的情况应该排除


```{r}
ggplot(aes(x=Promo,y=Sales),data=subset(train,Open==1 & Sales!=0))+
  geom_boxplot()+
  stat_summary(fun.y=mean,geom='point',shape=5,size=5)

```

从箱形图可以看出两者分布，有promo的销售额的整体略高于没有promo的情况。同时可以看到两个箱子顶端分布了不少异常值，这可能跟数据集规模有关。等进一步分析。


```{r}
qplot(x=Customers,data=subset(train,Open==1))+
  facet_grid(~Promo)
```

嗯，看起来促销并没有增加更多的进店客户，结合销售额与Promo的关系，推测promo提升了人均消费。

接下来我们来看每个门店的销售有没有不同。
```{r}

ggplot(aes(x=Store,y=Sales),data=subset(train,Open==1 & Sales!=0))+
  geom_jitter(alpha=1/20)+
  geom_line(stat='summary',fun.y=mean,color='orange')
  
```

明显看出，有些分店的平均销售额要远高于其它分店。 

接下来看下假期跟销售额的关系
(代码参考kaggle kernal)

```{r}

ggplot(aes(x=SchoolHoliday,y=Sales),data=subset(train,Sales!=0))+
  geom_jitter(alpha=1/50) + 
  stat_summary(fun.y=mean,geom='point',shape=5,size=5)+
  geom_boxplot(fill=NA)
```

不受学校假期影响的情况（0）的分布更多一些，通过箱型图可以看出来1的销售均值略高于0.而分布区间


```{r}
ggplot(aes(x=StateHoliday,y=Sales),data=subset(train,Sales!=0))+
  geom_jitter(alpha=1/50)+
  geom_boxplot(fill=NA,outlier.fill=NA)
```


从均值分布来看，没有假日的情况下，销售整体上要略高于节假日。节假日开门的门店占非常少的比例，这些门店在节假日的销售额偏高。


```{r}
ggplot(aes(x=Customers,y=Sales),data=train)+
  geom_point(alpha=1/20)+
  geom_smooth()
  
  
```

可以看出这两个变量线性相关，并少量异常值分布。

接下来，看Dayofweek跟Sales的关系。这里去掉了Sales为0的情况。因为前面分析单变量的时候，我们知道周日只有非常少的店铺是开门的情况，如果不排除掉销售为0的情况，可能不容易看出这两个变量的关系。

```{r}
qplot(x=factor(DayOfWeek),y=Sales,data=subset(train,Sales!=0),geom='boxplot')+
  stat_summary(fun.y=mean,geom='point')+
  coord_cartesian(ylim=c(0,20000))
```

这里我们看到，第7天的IQR相对较大而且均值也比较高。从箱型图可以看出这两个变量存在一些相关性。我们可以通过cor.test函数进一步查看。

```{r}
with(train,cor.test(DayOfWeek,Sales))
```

```{r}
qplot(x=factor(DayOfWeek),data=train)+
  facet_grid(~Promo)
```

这里可以看出第6天和第7天没有门店做Promo的促销活动。其它时间，两种分布同单变量分析的结果。



## 第二个dataframe 

```{r}
summary(store_add)
str(store_add)
```

这里有10个变量1115个观察对象分别是1115的分店。考虑将变量分成三部分来分析 1:Type.2:competition.3:promo2


## 单变量分析

首先，先看下storetype&asortment.前者是4种不同类型，后者表示分类的级别a = basic, b = extra, c = extended

```{r}
p1 <- qplot(x=StoreType,data=store_add)
p2 <- qplot(x=Assortment,data=store_add)

grid.arrange(p1,p2,ncol=1)
```

从柱状图来看，分类变量跟分类级别没有太大的关联性。在assortment 类型a和c中storetype都有分布，仅b非常特殊，同时b的比例非常非常小。

## Competition

这几个变量里有不少缺失值，我们来逐个看下。

```{r}
head(subset(store_add,is.na(CompetitionDistance)&is.na(CompetitionOpenSinceMonth)),2L)

```

这里有两个分店缺少大部分变量值，根据数据集情况，推测是缺失信息的可能性比较大。也就是说这几个分店都有竞争店只是没有信息而已。


```{r}
head(subset(store_add,is.na(CompetitionOpenSinceMonth)|is.na(CompetitionOpenSinceYear)),2L)
```

Competion的几个变量描述了离分店最近的竞争者的开店时间和距离。这里有351个分店有距离信息但是缺少开店时间。这里推测可能是信息无法获取或者因为开店日期是训练集之后的日期而被移除（可能性比较小）。考虑到这部分缺失值占30%分店比例，在合并前需要做进一步处理，否则会给训练集制造出一大堆的na值。
这里解决方案有两个：1，根据该变量与预测值的相关性，是否是必要的。2，查看这个变量的分布情况，是否可以用均值来填充。

```{r}
ggplot(aes(x=CompetitionOpenSinceYear),data=subset(store_add,!is.na(CompetitionOpenSinceYear)))+
  geom_histogram(binwidth=1,color='white')+
  #geom_density(alpha=.2)+
  scale_x_continuous(breaks=seq(1900,2017,10))
  
  
```

从直方图来看，分布偏态，1990年前的两个值应该是异常值。考虑去掉或者换成均值。

```{r}
summary(store_add$CompetitionOpenSinceYear)
summary(store_add$CompetitionOpenSinceMonth)
```


从summary来看，均值和中位数非常接近。

思路：
1考虑合并CompetitionOpenSinceYear和CompetitionOpenSinceMonth这两个变量做为训练用特征
2.增加一个值为1，0的变量CompetionOpen，比如如果开店时间是2010/5，那么所有这个日期之后的该分店的competionopen值为1.反之为0.即表示那一天这个店是否有competion。这样操作的考虑模型需要预测出每一日期每个分店的销售额，这样可以区分开不同日期的差别。但是同时需要考虑到测试集上的日期是在2015之后的，也就是说这种处理方式只会给测试集增加一个值全部为1的变量。这样看起来似乎没什么意义。
3.是否可以转化成一种代表竞争对手开店时间累积的变量？（思考）

变量StoreType中有一半的分店是a类型的。在Assortment中a水平分类也几乎点了一半,进一步查看这两个变量是否有关联或功能重复。


```{r}
qplot(x=CompetitionDistance+1,data=subset(store_add,!is.na(CompetitionDistance),
                                          color='orange',binwidth=1000))
```

从直方图可以看出，这个变量呈偏态分布。大部分的样本集中在0到5000区间，有很长的尾巴，末端看起来有异常值。



```{r}
qplot(x=CompetitionDistance+1,data=subset(store_add,!is.na(CompetitionDistance)))+
  scale_x_log10()
```

第二个直方图是经过对数转换之后，近似于正态分布。考虑对该变量做对数转换。
还有一种思路将变量分割成几个区间，每个区间是一个等级。这种处理方式可能对分析的时候有帮助，但是改变了整体特征空间，同时可能会增加一些不确定因素。比如区间该如何选择这个问题就引入了人为干扰。

```{r}
qplot(x=factor(Promo2),data=store_add)
```

嗯，看起来参加这种促销的门店占了一半以上的比例。

接下来关于开始促销的时间中有两个变量分别是年和周，其中有544个na值。

```{r}
table(subset(store_add,is.na(Promo2SinceYear))$Promo2)
```

544个门店并没有参加这类促销，因此相关变量全部为NA。


## 双变量分析


这里我们并不清楚storetype和分类依据，我们先将这两个变量同Promo2相关变量来做对比观察。

```{r}
p1 <- qplot(x=StoreType,fill=factor(Promo2),data=store_add)
p2 <- qplot(x=Assortment,fill=factor(Promo2),data=store_add)
grid.arrange(p1,p2,ncol=1)
```


```{r}
p1 <- qplot(x=StoreType,fill=PromoInterval,data=store_add)
p2 <- qplot(x=Assortment,fill=PromoInterval,data=store_add)
grid.arrange(p1,p2,ncol=1)
```

从图形上并没有发现相关性。

```{r}
qplot(x=StoreType,data=store_add)+
  facet_grid(~Assortment)
```

这里看出b非常特别，在a,c两种分类级别中都有a~d分布。而只有b分类级里只有b这一种type。


### 对train数据集操作：将storetype assorment合并到训练集

```{r}
pf <- select(store_add,Store,StoreType,Assortment)
train <- merge(train,pf,by='Store')

summary(train)

```

观察StoreType跟Sales是否有相关性。 

```{r}
ggplot(aes(x=StoreType,y=Sales),data=train)+
  geom_boxplot()+
  coord_cartesian(ylim=c(0,20000))+
  stat_summary(fun.y=mean,geom='point',shape=5,size=5)

  
```

从箱型图可以看出,b类型的门店销售均值和中位数都高于其它类型。

```{r}
ggplot(aes(x=Assortment,y=Sales),data=train)+
  geom_boxplot()+
  coord_cartesian(ylim=c(0,20000))+
  stat_summary(fun.y=mean,geom='point',shape=5,size=5)
```

从箱型图来看a,c分布比较相似。b的销售均值及中位数明显高于其它类型，考虑到这也可能与b型样本量过小有关。




### 对数据集store_add操作：填充na值，合并competitionsince变量
```{r}
#fill na
store_add$CompetitionOpenSinceMonth[is.na(store_add$CompetitionOpenSinceMonth)] <-  7
store_add$CompetitionOpenSinceYear[is.na(store_add$CompetitionOpenSinceYear)]  <-  2009
store_add$CompetitionOpenSinceYear[store_add$CompetitionOpenSinceYear < 1990] <- 2009
summary(store_add)
```
```{r}
store_add$one <- 1
store_add$CompetitionOpen <- paste(store_add$CompetitionOpenSinceYear,store_add$CompetitionOpenSinceMonth,store_add$one,sep='/')
store_add$CompetitionOpen <- as.Date(store_add$CompetitionOpen)
store_add$one <- NULL
```

接下来我们把这部分变量合并到train里

### 填充na值，并合并到train

```{r}
store_add$CompetitionDistance[is.na(store_add$CompetitionDistance)] <- 2325
train <- merge(train,select(store_add,Store,CompetitionOpen,CompetitionDistance),by='Store')
summary(train)
```

接下来我们可以对比观察CompetitionOpen和销售额是否有关联。
```{r}
ggplot(aes(x=CompetitionOpen,y=Sales),data=subset(train,Sales!=0))+
  geom_point(alpha=1/20)+
  geom_line(stat='summary',fun.y=mean,color='orange')
```

我们发现这样的图只能大概看出有一定的关系。为了捕捉到究竟竞争对手的出现对门店销量产生的影响，我们考虑增加一个变量来反应时间的变化。
我们增加了一个变量openlastmonth，即从某个时间点算起，竞争者经营时长，单位是月。 这里我希望观察到一个门店出现竞争者前及之后一年内的销售情况。

```{r}
bycomopen <- select(subset(train,HaveMissDate==0),Store,Date,Sales,CompetitionOpen)
bycomopen$Openlastmonth <- floor((bycomopen$Date - bycomopen$CompetitionOpen)/30)
bycomopen$Openlastmonth[bycomopen$Openlastmonth <0] <-  0
bycomopen$Openlastmonth <- as.numeric(bycomopen$Openlastmonth)
```


```{r}
openlast <- subset(bycomopen,Openlastmonth<=12)
openlast <- openlast[order(openlast$Date),]

```

```{r}
set.seed(188)
sample.id <-  sample(openlast$Store,9)
ggplot(aes(x=Date,y=Sales),data=subset(openlast,Store%in%sample.id&Sales!=0))+
  facet_wrap(~Store)+
  geom_jitter(aes(color=Openlastmonth))+
 # scale_color_brewer(type='div', palette=2)+
  geom_smooth()
 
```

我们通过对比观察了一部分门店的情况，大致可以看出来对于竞争者的出现，对于有些门店销售额的波动并不大。而有些门店在竞争者出现后的一段时间内业绩出现明险下滑。考虑到竞争者不同，可能带来的影响也不同。经过观察有一些门店在下滑后会出现上扬趋势，这可能跟之后一些促销有关系。



接下来，我们查看下距离变量对sale有没有影响。

```{r}

bydistance <-  train%>%
  group_by(CompetitionDistance)%>%
  summarise(sales.mean = mean(Sales))%>%
  arrange(CompetitionDistance)
bydistance$grad <- cut(bydistance$CompetitionDistance,c(0,5000,10000,20000,80000))

```

```{r}
ggplot(aes(x=CompetitionDistance,y=sales.mean),data=bydistance)+
  geom_jitter(alpha=0.2)+
  scale_x_log10()+
  #scale_y_log10()+
  geom_smooth(aes(color=grad))
```

比较反直觉的是竞争者的距离和销售似乎有太大相关性。我们可以通过cor.test函数来进一步了解。

```{r}
with(bydistance,cor.test(sales.mean,CompetitionDistance))
```

这里看起来并没有相关性。


### 先将Promo2合并入train，以便做进一步观察。

```{r}
train <- merge(train,select(store_add,Store,Promo2),by='Store')
```


接下来我们看下这个促销跟销售额有没有相关性

```{r}
bypromo2<- train%>%
  group_by(Promo2,Sales)%>%
  summarise(sales.mean = mean(Sales))%>%
  arrange(Promo2)
  
ggplot(aes(x=factor(Promo2),y=sales.mean),data=subset(bypromo2,Sales!=0))+
  geom_jitter(alpha = 1/50)+
  geom_boxplot(fill=NA,outlier.fill=NA)
```

这里反直觉的是，没有参与这类促销的门店销售均值反而更高一些。可能正是由于销售不好，这些门店才选择促销来增加销售额吧。

参加一种促销的门店是否会参加另一种？

```{r}
qplot(x=factor(Promo2),fill=Promo,data=train)
```

这两个变量没什么相关性。


# 测试集粗略分析
```{r}
summary(test_df)
str(test_df)

```

测试集有8个变量41088条观察。Open变量有11个NA值。StateHoliday变量不同于训练集的4种值，在测试集里只有0和a两种。

### 对测试集操作：变量类型转换
```{r}
test_df$Date <- as.Date(test_df$Date)
summary(test_df$Date)
```

我们的预测目标是15年8月到9月17号这段时间。
查看下训练集中89月份的stateholiday

```{r}

p1 <- qplot(x=StateHoliday,data=subset(train,month(Date)==8 | month(Date)==9))
p2 <- qplot(x=SchoolHoliday,data=subset(train,month(Date)==8 | month(Date)==9))
grid.arrange(p1,p2,ncol=2)
```

可以看出来这两个月份确实只有0，a两种值，schoolholiday变量这两个月份1的比率比整体要高。应该跟暑期有关。

```{r}
test_df[is.na(test_df),]  #代码参考kaggle

```
622分店9-5到17期间Open值缺失，这里判断应该填充为1。这里即没有StateHoliday也没有SchoolHoliday. 也不是周日。

### 对测试集操作：填充缺失值
```{r}
test_df$Open[is.na(test_df$Open)] <- 1  
```



# 最后总结

## 图一
```{r}
ggplot(aes(x=CompetitionDistance,y=sales.mean),data=bydistance)+
  geom_jitter(alpha=0.2)+
  scale_x_log10()+
  #scale_y_log10()+
  geom_smooth(aes(color=grad))
```

在画图前，我直觉的以为竞争对手的距离会是影响销售的重要因素，而就目前来看两者并没有相关性。之后会尝试结合其它变量做进一步分析。

## 图二（代码参考kaggle)

```{r}
p1 <- ggplot(aes(x=Date,y=Sales,color=Assortment),data=subset(train,Sales!=0))+
  geom_smooth(size=2)+ggtitle('Assortment')+
  scale_x_date(date_breaks='6 month')
p2 <- ggplot(aes(x=Date,y=Sales,color=StoreType),data=subset(train,Sales!=0))+
  geom_smooth(size=2)+ggtitle('StoreType')+
  scale_x_date(date_breaks='6 month')

grid.arrange(p1,p2,ncol=1)
```

这里可以看出Assortment变量中a,c的趋势比较接近，而销售平均水平不同。而b分类整体呈上升趋势，平均销售水平远高于其它类型。同样商店类型b的平均销售水平和趋势明显不同于其它分类。


## 图三

```{r}
bycomopen$Year <- year(bycomopen$Date)
bycomopen$Month <- month(bycomopen$Date)

sales.ts <- bycomopen%>%
  group_by(Year,Month)%>%
  summarise(monthmean = mean(Sales))%>%
  arrange(Year)
```

```{r}
library(forecast)
sales.ts <- ts(sales.ts$monthmean,start=2013,frequency = 12)
  
```

```{r}
p1 <- ggseasonplot(sales.ts,year.labels=TRUE,year.labels.left=TRUE)+ggtitle('Seasonal plot for stores without missing date')
p2 <- ggsubseriesplot(sales.ts,label=month.abb)+ggtitle('Seasonal subseries plot')
#p3 <- gglagplot(sales.ts)
grid.arrange(p1,p2,ncol=1)
```

总体来讲，这个数据集以及预测的目标都是时间序列的。那么可能会有一些季节性的规律存在。这里我们按月份画出不同年份月平均销售额的走势。这里去掉了缺失半年销售数据的门店，虽然丢掉了不少样本，但考虑到这里的目的是捕捉季节性规律，因此作为权衡，我们在这里只使用日期完整的门店数据。大致上可以看出有一些走势相同的月份，比如1月可能受12月份消费高峰期影响会比较低，而到了2，3月份有所回升。这可能跟2月份的假期有关系。到了5月份明显的下滑，过后双出现了销售峰期。我们在subseries里能看到每个月份，三年的走势。我们看到有些月份趋势是逐年上升，而有些月份发生了方向变化。







## 反思
因为数据样本比较多，当我们想通过日期来观察趋势的时候遇到了一些问题。因为每个日期都有1000多个观察样本，而训练集就包含了两年多的观察数据。因此会出现很多干扰，不能清晰的观察到一些潜在的特征影响。当换一种方式来绘制的时候这些规律才显现出来。这里还有三个变量没有加入训练集，这将是之后的工作。
考虑到这个变量也是预测目标在前面过早的丢掉了customer变量。在最后做季节性绘图的时候，突然想到这个变量可能可以帮助我们观察到一些规律。对于有些门店来说，比如社区附近，可能销售有很大一部分来自于相对固定的消费群。那么他们可能会不会有一些比较固定的消费习惯呢？当然这个只是猜测，需要之后做一些分析。
除此之外，这个数据集还有一些工作待尝试。比如，我们要预测的是一个时间点之后的销售，那么我们能不能通过观察时间点之前的一段时间的情况得出一些有用的信息？此外，还有一个滞后性的因素可能需要考虑。比如当出现竞争对手或者当采取了持续性促销后，对销售额的影响可能会有一些滞后性。
之后会尝试多变量观察，尝试的重点，我想可能还会放在时间趋势上。


